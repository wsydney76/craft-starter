{% set isFloat = display in ['left','right'] %}
{% set query = block.image %}

{% if not isFloat %}
    {% set transform = display == 'fullHeight' ? 'contentImageFullHeight' : 'contentImage' %}
    {% set transformMd = transform ~ 'Md' %}
    {% set transformXs= transform ~ 'Xs' %}
    {% set query = query.withTransforms([transform, transformMd, transformXs]) %}
{% endif %}

{% set image = query.one %}

{% if image %}
    {% set caption = block.caption ?: image.title %}

    {% if isFloat %}
        {% set imgAttr = {
            src: image.url('galleryThumbnail'),
            alt: caption != image.title ? image.title : '',
            loading: 'lazy'
        } %}
        {% set figureAttr = {
            class: "figure bg-white pb-1 text-sm shadow"
        } %}
    {% else %}
        {% set imgAttr = {
            src: image.url(transformMd),
            srcset: "#{image.url(transformXs)} 420w, #{image.url(transformMd)} 768w, #{image.url(transform)} 1160w",
            alt: caption != image.title ? image.title : '',
            loading: 'lazy'
        } %}
        {% set figureAttr = {
            class: "figure"
        } %}
    {% endif %}

    <figure {{ attr(figureAttr) }}>

        <img {{ attr(imgAttr) }}>

        {% if image.copyright %}
            {% set caption -%}
                {{ caption }} &copy; {{ image.copyright }}
            {%- endset %}

        {% endif %}

        {% if caption %}
            <figcaption class="my-3 text-center">
                {{ caption }}
            </figcaption>
        {% endif %}
    </figure>

{% endif %}
